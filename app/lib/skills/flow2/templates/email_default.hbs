<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flow2 Approval {{#if is_reminder}}Reminder{{/if}}</title>
</head>
<body style="margin: 0; padding: 0; background-color: #f5f5f5;">
  <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 650px; margin: 0 auto; padding: 20px; background-color: #ffffff;">

    {{#if is_reminder}}
    <div style="background: #fef3c7; border: 2px solid #fbbf24; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
      <h3 style="margin: 0 0 8px 0; color: #92400e; font-size: 16px;">â° REMINDER: Action Required</h3>
      <p style="margin: 0; color: #92400e; font-size: 14px;">
        This review has been waiting for ~{{elapsed_minutes}} minutes. Please review and respond.
      </p>
    </div>
    {{/if}}

    <h2 style="color: #1e40af; margin-bottom: 8px;">Flow2 KYC Review Awaiting Approval</h2>
    <p style="color: #6b7280; margin-top: 0;">A KYC review workflow has paused and requires your decision.</p>

    <div style="background: #f3f4f6; padding: 16px; border-radius: 8px; margin: 20px 0;">
      <p style="margin: 4px 0;"><strong>Run ID:</strong> <code style="background: #e5e7eb; padding: 2px 6px; border-radius: 3px;">{{run_id}}</code></p>
      <p style="margin: 4px 0;"><strong>Documents:</strong> {{document_count}} file(s) uploaded (see attachments below)</p>
      <p style="margin: 4px 0;"><strong>Paused At:</strong> {{paused_at}}</p>
    </div>

    {{#if issues}}
    <div style="background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; padding: 16px; margin: 20px 0;">
      <h3 style="margin: 0 0 12px 0; color: #dc2626; font-size: 16px;">âš ï¸ {{issues.length}} Issue(s) Detected</h3>
      {{#each issues}}
      <div style="margin: 8px 0; padding: 8px; background: white; border-radius: 4px;">
        <p style="margin: 0; font-weight: 600; color: {{#if (eq this.severity 'critical')}}#dc2626{{else}}{{#if (eq this.severity 'high')}}#dc2626{{else}}{{#if (eq this.severity 'medium')}}#ea580c{{else}}#6b7280{{/if}}{{/if}}{{/if}};">
          {{#if (eq this.severity 'critical')}}ğŸ”´{{else}}{{#if (eq this.severity 'high')}}ğŸ”´{{else}}{{#if (eq this.severity 'medium')}}ğŸŸ {{else}}â„¹ï¸{{/if}}{{/if}}{{/if}} {{this.message}}
        </p>
      </div>
      {{/each}}
    </div>
    {{/if}}

    {{#if topic_summaries}}
    <h3 style="color: #374151; font-size: 16px; margin: 32px 0 12px 0;">ğŸ“Š Topic Summary (KYC Analysis)</h3>
    <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 16px; margin: 16px 0;">
      {{#each topic_summaries}}
      <div style="margin: 16px 0; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid {{#if (eq this.coverage 'PRESENT')}}#10b981{{else}}{{#if (eq this.coverage 'WEAK')}}#f59e0b{{else}}#6b7280{{/if}}{{/if}};">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <h4 style="margin: 0; color: #1e40af; font-size: 14px;">{{this.title}}</h4>
          <span style="font-size: 11px; font-weight: 600; color: {{#if (eq this.coverage 'PRESENT')}}#10b981{{else}}{{#if (eq this.coverage 'WEAK')}}#f59e0b{{else}}#6b7280{{/if}}{{/if}}; background: {{#if (eq this.coverage 'PRESENT')}}#10b98115{{else}}{{#if (eq this.coverage 'WEAK')}}#f59e0b15{{else}}#6b728015{{/if}}{{/if}}; padding: 4px 8px; border-radius: 4px;">
            {{#if (eq this.coverage 'PRESENT')}}âœ“{{else}}{{#if (eq this.coverage 'WEAK')}}âš {{else}}â—‹{{/if}}{{/if}} {{this.coverage}}
          </span>
        </div>
        {{#if this.bullets}}
        <ul style="margin: 8px 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
          {{#each this.bullets}}
          <li style="margin: 4px 0;">{{this}}</li>
          {{/each}}
        </ul>
        {{/if}}
        {{#if this.evidence}}
        <p style="margin: 8px 0 0 0; padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 12px; color: #6b7280; font-style: italic;">
          ğŸ“ Evidence: "{{#if this.evidence.[0].quote}}{{substring this.evidence.[0].quote 0 120}}{{#if (gt this.evidence.[0].quote.length 120)}}...{{/if}}{{/if}}"
        </p>
        {{/if}}
      </div>
      {{/each}}
    </div>
    {{/if}}

    <h3 style="color: #374151; font-size: 16px; margin: 24px 0 12px 0;">ğŸ“ Attached Documents</h3>
    <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 16px; margin: 16px 0;">
      <p style="margin: 0 0 12px 0; font-size: 14px; color: #15803d; font-weight: 600;">
        âœ“ {{document_count}} original document(s) attached to this email:
      </p>
      {{#each documents}}
      <p style="margin: 6px 0; font-size: 13px; color: #166534; padding-left: 16px;">
        ğŸ“„ {{@index}}. {{this.filename}}
      </p>
      {{/each}}
      <p style="margin: 12px 0 0 0; font-size: 12px; color: #6b7280; font-style: italic;">
        ğŸ’¡ Download attachments to review the complete documents.
      </p>
    </div>

    <div style="margin: 32px 0; padding: 20px; background: #f9fafb; border-radius: 8px; text-align: center;">
      <p style="margin: 0 0 16px 0; color: #374151; font-weight: 600;">Choose an action:</p>
      <a href="{{approve_url}}"
         style="display: inline-block; padding: 14px 32px; background: #10b981; color: white; text-decoration: none; border-radius: 6px; margin: 0 8px; font-weight: 600; font-size: 16px;">
        âœ… Approve & Continue
      </a>
      <a href="{{reject_url}}"
         style="display: inline-block; padding: 14px 32px; background: #ef4444; color: white; text-decoration: none; border-radius: 6px; margin: 0 8px; font-weight: 600; font-size: 16px;">
        âŒ Reject
      </a>
    </div>

    <p style="color: #6b7280; font-size: 12px; margin-top: 40px; padding-top: 16px; border-top: 1px solid #e5e7eb; text-align: center;">
      Flow2 Approval System{{#if is_reminder}} - Reminder{{/if}}<br/>
      Message ID: {{message_id}}<br/>
      Token: {{token_hint}}...
    </p>
  </div>
</body>
</html>
